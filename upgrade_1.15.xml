<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>Dougiefresh:Split_Forum</id>
<version>1.15</version>

<file name="$sourcedir/Load.php">
	<operation>
		<search position="replace"><![CDATA[$cookiename = $row['cookiename'];
			$language = $row['language'];
			$favicon = $row['favicon'];
			$modSettings['primary_membergroup'] = $row['primary_membergroup'];]]></search>
		<add><![CDATA[$language = $row['language'];
			$favicon = $row['favicon'];
			break;]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// Replace the Simple Portal settings with the Subforum setting if available:]]></search>
		<add><![CDATA[// Replace certain settings with the Subforum setting if available:
	$modSettings['primary_membergroup'] = $subforum_tree[$forumid]['primary_membergroup'];]]></add>
	</operation>
</file>
<file name="$sourcedir/PortalAdminBlocks.php" error="skip">
	<operation error="ignore">
		<search position="replace"><![CDATA[global $context, $txt, $scripturl, $sourcedir, $forumid;]]></search>
		<add><![CDATA[global $context, $txt, $sourcedir, $forumid;]]></add>
	</operation>
</file>
<file name="$sourcedir/Subs-Portal.php" error="skip">
	<operation error="ignore">
		<search position="replace"><![CDATA[global $smcFunc, $context, $settings, $options, $txt, $forumid;]]></search>
		<add><![CDATA[global $smcFunc, $context, $options, $txt, $forumid;]]></add>
	</operation>
</file>
<file name="$sourcedir/ManageBoards.php">
	<operation>
		<search position="replace"><![CDATA[foreach ($context['board_order'] as $cat => $boards)]]></search>
		<add><![CDATA[foreach ($context['board_order'] as $cat => $boards2)]]></add>
	</operation>
	<operation error="ignore">
		<search position="replace"><![CDATA[$boardOptions['alias_cat'] = isset($_POST['alias_cat']) ? implode(',', $_POST['alias_cat']) : '';
		$boardOptions['alias_child'] = isset($_POST['alias_child']) ? implode(',', $_POST['alias_child']) : '';]]></search>
		<add><![CDATA[$boardOptions['alias_cat'] = isset($_POST['alias_cat' . $sub]) ? implode(',', $_POST['alias_cat' . $sub]) : '';
		$boardOptions['alias_child'] = isset($_POST['alias_child' . $sub]) ? implode(',', $_POST['alias_child' . $sub]) : '';]]></add>
	</operation>
</file>
<file name="$themedir/ManageBoards.template.php">
	<operation>
		<search position="replace"><![CDATA[document.getElementById("new_cat' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");';]]></search>
		<add><![CDATA[document.getElementById("new_cat' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");
			document.getElementById("alias_cat' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");
			document.getElementById("alias_child' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");';]]></add>
	</operation>
	<operation error="ignore">
		<search position="replace"><![CDATA[</dt>
							<dd>
								<select name="alias_cat[]" multiple="multiple">
									<option value="">', $txt['no_cat_selected'], '</option>';
	foreach ($cat_tree as $category)
		echo '
									<option', !isset($context['board']['is_new']) && in_array($category['node']['id'], $context['board']['alias_cat']) ? ' selected="selected"' : '', ' value="', $category['node']['id'], '">', $category['node']['name'], '</option>';
	echo '
								</select>
							</dd>]]></search>
		<add><![CDATA[</dt>';
	foreach ($subforum_tree as $id => $subforum)
	{
		echo '
							<dd id="alias_cat', $id, '"', ($_REQUEST['sub'] != $id ? ' style="display: none;"' : '') . '>
								<select name="alias_cat' . $id . '[]" multiple="multiple">
									<option value="">', $txt['no_cat_selected'], '</option>';
		foreach ($cat_tree as $category)
			if ($category['node']['forumid'] == $id)
				echo '
									<option', !isset($context['board']['is_new']) && in_array($category['node']['id'], $context['board']['alias_cat']) ? ' selected="selected"' : '', ' value="', $category['node']['id'], '">', $category['node']['name'], '</option>';
		echo '
								</select>
							</dd>';]]></add>
	</operation>
	<operation error="ignore">
		<search position="replace"><![CDATA[</dt>
							<dd>
								<select name="alias_child[]" multiple="multiple">
									<option value="">', $txt['no_boards_selected'], '</option>';
	foreach ($boards as $board)
		echo '
									<option', !isset($context['board']['is_new']) && in_array($board['id'], $context['board']['alias_child']) ? ' selected="selected"' : '', ' value="', $board['id'], '">', $board['name'], '</option>';
	echo '
								</select>
							</dd>]]></search>
		<add><![CDATA[</dt>';
	foreach ($subforum_tree as $id => $subforum)
	{
		echo '
							<dd id="alias_child', $id, '"', ($_REQUEST['sub'] != $id ? ' style="display: none;"' : '') . '>
								<select name="alias_child' . $id . '[]" multiple="multiple">
									<option value="">', $txt['no_boards_selected'], '</option>';
		foreach ($boards as $board)
		{
			if ($cat_tree[$board['category']]['node']['forumid'] == $id)
				echo '
									<option', !isset($context['board']['is_new']) && in_array($board['id'], $context['board']['alias_child']) ? ' selected="selected"' : '', ' value="', $board['id'], '">', $board['name'], '</option>';
		}
		echo '
								</select>
							</dd>';
	}
	echo ']]></add>
	</operation>
</file>
</modification>