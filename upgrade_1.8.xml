<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>Dougiefresh:Split_Forum</id>
<version>1.8</version>

<!-------------------------------------------------------------------------->
<!-- Bug fix for web paths not loading properly without www. in URL       -->
<!-------------------------------------------------------------------------->
<file name="$sourcedir/Load.php">
	<operation>
		<search position="replace"><![CDATA[$dir = $_SERVER['REQUEST_URI'];
	$dir = str_replace('/index.php', '', 'http://' . $_SERVER['HTTP_HOST'] . substr($dir, 0, strrpos($dir, '/')));
	if (!is_array($subforum_tree))
		$subforum_tree = array();
	foreach ($subforum_tree as $id => $row)
	{
		if ($row['boardurl'] == $dir)]]></search>
		<add><![CDATA[	$host = strtolower($_SERVER['SERVER_NAME']);
	$uri = str_replace('/index.php', '', substr($_SERVER['REQUEST_URI'], 0, strrpos($_SERVER['REQUEST_URI'], '/')));
	foreach ($subforum_tree as $id => $row)
	{
		$url = parse_url($row['boardurl']);
		$test1 = strtolower($url['host']);
		$test2 = strtolower(str_replace('www.', '', $test1));
		if (($test1 == $host || $test2 == $host) && $url['path'] == $uri)]]></add>
	</operation>
</file>

<!-------------------------------------------------------------------------->
<!-- Bug fix for SimplePortal not being able to save settings             -->
<!-------------------------------------------------------------------------->
<file name="$sourcedir/PortalAdminMain.php" error="skip">
	<operation>
		<search position="before"><![CDATA[global $smcFunc, $context, $scripturl, $txt, $subforum_tree, $forumid]]></search>
		<add><![CDATA[, $sourcedir]]></add>
	</operation>
</file>
</modification>