<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>Dougiefresh:Split_Forum</id>
<version>1.12</version>

<file name="$themedir/ManageBoards.template.php">
	<operation>
		<search position="replace"><![CDATA[global $context, $settings, $options, $scripturl, $txt, $modSettings;

	// Table header.
	echo '
	<div id="manage_boards">
		<div class="title_bar">
			<h3 class="titlebg">', $txt['boardsEdit'], '</h3>
		</div>';

	if (!empty($context['move_board']))
		echo '
		<div class="information">
			<p>', $context['move_title'], ' [<a href="', $scripturl, '?action=admin;area=manageboards">', $txt['mboards_cancel_moving'], '</a>]', '</p>
		</div>';
]]></search>
		<add><![CDATA[global $context, $settings, $options, $scripturl, $txt, $modSettings;
	global $subforum_tree, $cat_tree, $forumid;

	// Table header.
	echo '
	<script type="text/javascript"><!-- // --><![CDATA[<]]><![CDATA[![CDATA[
		function expandTabs(forum)
		{
			';
	foreach ($subforum_tree as $subforum => $info)
		echo 'document.getElementById("subforum' . $subforum . '").style.display = (forum == ' . $subforum . ' ? "" : "none");
			document.getElementById("tab' . $subforum . '").className = (forum == ' . $subforum . ' ? "tabActiveHeader" : "");
			';
	echo '
		}
	// ]]]]><![CDATA[></script>
	<div id="manage_boards">
		<div class="title_bar">
			<h3 class="titlebg">', $txt['boardsEdit'], '</h3>
		</div>';

	if (!empty($context['move_board']))
		echo '
		<div class="information">
			<p>', $context['move_title'], ' [<a href="', $scripturl, '?action=admin;area=manageboards">', $txt['mboards_cancel_moving'], '</a>]', '</p>
		</div>';

	// Display the subforums as a tab at the top of the screen:
	$flagged = array( 0 => false );
	if (count($subforum_tree) > 1)
	{
		echo '
		<div id="tabContainer">
			<div class="tabs">
				<ul>';
		foreach ($subforum_tree as $id => $section)
		{
			echo '
					<li', ($id == $context['req_forumid'] ? ' class="tabActiveHeader"' : ''), ' id="tab' . $id . '"><a href="javascript:void(0);" onclick="expandTabs(' . $id . '); return false;">', (isset($section['boardname']) ? $section['boardname'] : '# '.$section['forumid']), '</a></li>';
			$flagged[$id] = false;
		}
		echo '
				</ul>
			</div>
		</div>';
	}
]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[</div>
	<br class="clear" />';
}

// Template for editing/adding a category on the forum.
function template_modify_category()
{
	global $context, $settings, $options, $scripturl, $txt;

	// Print table header.
	echo '
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=cat2" method="post" accept-charset="', $context['character_set'], '">
			<input type="hidden" name="cat" value="', $context['category']['id'], '" />]]></search>
		<add><![CDATA[</div></div>';
	foreach ($flagged as $id => $flag)
	{
		if (!$flag)
			echo '
	<div id="subforum' . $id . '"' . ($context['req_forumid'] <> $id ? ' style="display: none;"' : '') . '>
		<div class="windowbg">
			<span class="topslice"><span></span></span>
			<div class="content centertext">
				', $txt['mboards_no_cats'], '
			</div>
			<span class="botslice"><span></span></span>
		</div>
	</div>';
	}
	echo '
	<br class="clear" />';
}

// Template for editing/adding a category on the forum.
function template_modify_category()
{
	global $context, $settings, $options, $scripturl, $txt, $subforum_tree, $forumid;

	// Print table header.
	echo '
	<script type="text/javascript"><!-- // --><![CDATA[<]]><![CDATA[![CDATA[
		function SubForumsCategories(forum)
		{
			';
	foreach ($subforum_tree as $subforum => $info)
		echo 'document.getElementById("cat_txt' . $subforum . '").style.display = (forum == ' . $subforum . ' ? "" : "none");
			document.getElementById("cat_ord' . $subforum . '").style.display = (forum == ' . $subforum . ' ? "" : "none");
			';
	echo '
		}
	// ]]]]><![CDATA[></script>
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=cat2' . (!empty($_REQUEST['sub']) ? ';sub=' . $_REQUEST['sub'] : '') .'" method="post" accept-charset="', $context['character_set'], '">
			<input type="hidden" name="cat" value="', $context['category']['id'], '" />
			<input type="hidden" name="forumid" value="', $context['category']['forumid'], '" />]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[<dt>
							<strong>' . $txt['collapse_enable'] . '</strong><br />
							<span class="smalltext">' . $txt['collapse_desc'] . '</span>
						</dt>
						<dd>
							<input type="checkbox" name="collapse"', $context['category']['can_collapse'] ? ' checked="checked"' : '', ' tabindex="', $context['tabindex']++, '" class="input_check" />
						</dd>';]]></search>
		<add><![CDATA[
	// If this isn't the only subforum, let the user choose which subforum it should be placed in:
	if (count($subforum_tree) > 1)
	{
		echo '
						<dt>
							<strong>' . $txt['forumid_title']. '</strong><br />
							<span class="smalltext">' . $txt['forumid_desc'] . '</span>
						</dt>
						<dd>
							<select name="forum_id" onchange="SubForumsCategories(this.options[this.selectedIndex].value); return false;">';
		// Print every existing category into a select box.
		foreach ($subforum_tree as $row)
			echo '
								<option', $context['category']['forumid'] == $row['forumid'] ? ' selected="selected"' : '', ' value="', $row['forumid'], '">', $row['boardname'], '</option>';
		echo '
							</select>
						</dd>';
	} else {
		echo '
						<input type="hidden" name="forum_id" value="', $forumid, '" size="4" tabindex="', $context['tabindex']++, '" />';
	}
]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// Link to modify the category.
		echo '
			<div class="cat_bar">
				<h3 class="catbg">
					<a href="' . $scripturl . '?action=admin;area=manageboards;sa=cat;cat=' . $category['id'] . '">', $category['name'], '</a> <a href="' . $scripturl . '?action=admin;area=manageboards;sa=cat;cat=' . $category['id'] . '">', $txt['catModify'], '</a>]]></search>
		<add><![CDATA[// Link to modify the category.
		echo '
			<div class="cat_bar">
				<h3 class="catbg">
					<a href="' . $scripturl . '?action=admin;area=manageboards;sa=cat;cat=' . $category['id'] . ($forumid == 0 ? ';sub=' . $category['forumid'] : '') . '">', $category['name'], '</a> <a href="' . $scripturl . '?action=admin;area=manageboards;sa=cat;cat=' . $category['id'] . ';sub=' . $category['forumid'] . '">', $txt['catModify'], '</a>]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<form action="', $scripturl, '?action=admin;area=manageboards;sa=newboard;cat=', $category['id'], '" method="post" accept-charset="', $context['character_set'], '">]]></search>
		<add><![CDATA[<form action="', $scripturl, '?action=admin;area=manageboards;sa=newboard;cat=', $category['id'], ($forumid == 0 ? ';sub=' . $category['forumid'] : ''), '" method="post" accept-charset="', $context['character_set'], '">]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[function template_confirm_category_delete()
{
	global $context, $settings, $options, $scripturl, $txt;

	// Print table header.
	echo '
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=cat2" method="post" accept-charset="', $context['character_set'], '">]]></search>
		<add><![CDATA[function template_confirm_category_delete()
{
	global $context, $settings, $options, $scripturl, $txt;

	// Print table header.
	echo '
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=cat2' . (!empty($_REQUEST['sub']) ? ';sub=' . $_REQUEST['sub'] : '') .'" method="post" accept-charset="', $context['character_set'], '">]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[function template_modify_board()
{
	global $context, $settings, $options, $scripturl, $txt, $modSettings;

	// The main table header.
	echo '
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2" method="post" accept-charset="', $context['character_set'], '">]]></search>
		<add><![CDATA[function template_modify_board()
{
	global $context, $settings, $options, $scripturl, $txt, $modSettings, $forumid, $subforum_tree;

	// The main table header.
	echo '
	<script type="text/javascript"><!-- // --><![CDATA[<]]><![CDATA[![CDATA[
		function hideCategories(forum)
		{';
	foreach ($subforum_tree as $subforum)
		echo '
			document.getElementById("new_cat' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");
			document.getElementById("alias_cat' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");
			document.getElementById("alias_child' . $subforum['forumid'] . '").style.display = (forum == ' . $subforum['forumid'] . ' ? "" : "none");';
	echo '
			hideBoards(document.getElementById("new_cat" + forum).options[document.getElementById("new_cat" + forum).selectedIndex].value);
		}
		function hideBoards(cat)
		{';
	foreach ($context['board_order'] as $cat => $boards)
		foreach ($boards as $board)
			echo '
			document.getElementById("cat_txt', $cat, '").style.display = (cat == ' . $cat . ' ? "" : "none");
			document.getElementById("cat_opt', $cat, '").style.display = (cat == ' . $cat . ' ? "" : "none");';
	echo '
		}
	// ]]]]><![CDATA[></script>
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2', (!empty($_REQUEST['sub']) ? ';sub=' . $_REQUEST['sub'] : ''), (!empty($_REQUEST['cat']) ? ';cat=' . $_REQUEST['cat'] : ''), '" method="post" accept-charset="', $context['character_set'], '">]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[function template_confirm_board_delete()
{
	global $context, $settings, $options, $scripturl, $txt;

	// Print table header.
	echo '
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2" method="post" accept-charset="', $context['character_set'], '">]]></search>
		<add><![CDATA[function template_confirm_board_delete()
{
	global $context, $settings, $options, $scripturl, $txt;

	// Print table header.
	echo '
	<div id="manage_boards">
		<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2' . (!empty($_REQUEST['sub']) ? ';sub=' . $_REQUEST['sub'] : '') .'" method="post" accept-charset="', $context['character_set'], '">]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<li', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? ' id="recycle_board"' : ' ', ' class="windowbg', $alternate ? '' : '2', '" style="padding-' . ($context['right_to_left'] ? 'right' : 'left') . ': ', 5 + 30 * $board['child_level'], 'px;', $board['move'] ? 'color: red;' : '', '"><span class="floatleft"><a href="', $scripturl, '?board=', $board['id'], '">', $board['name'], '</a>', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? '<a href="' . $scripturl . '?action=admin;area=manageboards;sa=settings"> <img src="' . $settings['images_url'] . '/post/recycled.gif" alt="' . $txt['recycle_board'] . '" /></a></span>' : '</span>', '
							<span class="floatright">', $context['can_manage_permissions'] ? '<span class="modify_boards"><a href="' . $scripturl . '?action=admin;area=permissions;sa=index;pid=' . $board['permission_profile'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '">' . $txt['mboards_permissions'] . '</a></span>' : '', '
							<span class="modify_boards"><a href="', $scripturl, '?action=admin;area=manageboards;move=', $board['id'], '">', $txt['mboards_move'], '</a></span>
							<span class="modify_boards"><a href="', $scripturl, '?action=admin;area=manageboards;sa=board;boardid=', $board['id'], '">', $txt['mboards_modify'], '</a></span></span><br style="clear: right;" />]]></search>
		<add><![CDATA[<li', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? ' id="recycle_board"' : ' ', ' class="windowbg', $alternate ? '' : '2', '" style="padding-' . ($context['right_to_left'] ? 'right' : 'left') . ': ', 5 + 30 * $board['child_level'], 'px;', $board['move'] ? 'color: red;' : '', '"><span class="floatleft"><a href="', $subforum_tree[$category['forumid']]['boardurl'], '/index.php?board=', $board['id'], '">', $board['name'], '</a>', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? '<a href="' . $subforum_tree[$category['forumid']]['boardurl'] . '?action=admin;area=manageboards;sa=settings"> <img src="' . $settings['images_url'] . '/post/recycled.gif" alt="' . $txt['recycle_board'] . '" /></a></span>' : '</span>', '
							<span class="floatright">', $context['can_manage_permissions'] ? '<span class="modify_boards"><a href="' . $scripturl . '?action=admin;area=permissions;sa=index;pid=' . $board['permission_profile'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '">' . $txt['mboards_permissions'] . '</a></span>' : '', '
							<span class="modify_boards"><a href="', $scripturl, '?action=admin;area=manageboards;move=', $board['id'], ($forumid == 0 ? ';sub=' . $category['forumid'] : ''), '">', $txt['mboards_move'], '</a></span>
							<span class="modify_boards"><a href="', $scripturl, '?action=admin;area=manageboards;sa=board;boardid=', $board['id'], ($forumid == 0 ? ';sub=' . $category['forumid'] : ''), '">', $txt['mboards_modify'], '</a></span></span><br style="clear: right;" />]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// No categories so show a label.
	if (empty($context['categories']))
		echo '
		<div class="windowbg">
			<span class="topslice"><span></span></span>
			<div class="content centertext">
				', $txt['mboards_no_cats'], '
			</div>
			<span class="botslice"><span></span></span>
		</div>';

	// Loop through every category, listing the boards in each as we go.
	foreach ($context['categories'] as $category)
	{
		]]></search>
		<add><![CDATA[// Loop through every category, listing the boards in each as we go.
	$last_forumid = -1;
	foreach ($context['categories'] as $category)
	{
		// If this is a different subforum, place it in a div:
		if ($last_forumid <> $category['forumid'])
		{
			if ($last_forumid > -1)
				echo '</div>';
			echo '<div id="subforum' . $category['forumid'] . '"' . ($context['req_forumid'] <> (int)$category['forumid'] ? ' style="display: none;"' : '') . '>';
			$last_forumid = $category['forumid'];
			$flagged[$category['forumid']] = true;
		}
	
		]]></add>
	</operation>
	<operation>
		<search position="after"><![CDATA[// Option for choosing the category the board lives in.]]></search>
		<add><![CDATA[// Option for choosing the subforum the board lives in.
	if (count($subforum_tree) > 1)
	{
		echo '
						<dt>
							<strong>', $txt['forumid_title'], ':</strong>

						</dt>
						<dd>
							<select name="new_forum" onchange="hideCategories(this.options[this.selectedIndex].value);">';
		foreach ($subforum_tree as $subforum)
			echo '
								<option value="', $subforum['forumid'], '" ', $subforum['forumid'] == $_REQUEST['sub'] ? ' selected="selected"' : '', '>', $subforum['boardname'], '</option>';
		echo '
							</select>
						</dd>';
	}
	else
		echo '
						<input type="hidden" name="new_forum" value="', $_REQUEST['sub'], '" />';
	
	]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<dd>
							<select name="new_cat" onchange="if (this.form.order) {this.form.order.disabled = this.options[this.selectedIndex].value != 0; this.form.board_order.disabled = this.options[this.selectedIndex].value != 0 || this.form.order.options[this.form.order.selectedIndex].value == \'\';}">';
		foreach ($context['categories'] as $category)
			echo '
								<option', $category['selected'] ? ' selected="selected"' : '', ' value="', $category['id'], '">', $category['name'], '</option>';
		echo '
							</select>
						</dd>';]]></search>
		<add><![CDATA[<dd>';
	foreach ($subforum_tree as $subforum)
	{
		echo '
							<select name="new_cat', $subforum['forumid'], '" id="new_cat', $subforum['forumid'], '" onchange="hideBoards(this.options[this.selectedIndex].value);"', ($subforum['forumid'] <> $_REQUEST['sub'] ? ' style="display: none;"' : ''), '>';
		foreach ($context['categories'][$subforum['forumid']] as $category)
			echo '
								<option', $category['selected'] ? ' selected="selected"' : '', ' value="', $category['id'], '">', $category['name'], '</option>';
		echo '
							</select>';
	}
	echo '
						</dd>';]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// If this isn't the only board in this category let the user choose where the board is to live.
	if ((isset($context['board']['is_new']) && count($context['board_order']) > 0) || count($context['board_order']) > 1)
	{
		echo '
						<dt>
							<strong>', $txt['order'], ':</strong>
						</dt>
						<dd>';

	// The first select box gives the user the option to position it before, after or as a child of another board.
	echo '
							<select id="order" name="placement" onchange="this.form.board_order.disabled = this.options[this.selectedIndex].value == \'\';">
								', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '', '
								<option value="after">' . $txt['mboards_order_after'] . '...</option>
								<option value="child">' . $txt['mboards_order_child_of'] . '...</option>
								<option value="before">' . $txt['mboards_order_before'] . '...</option>
							</select>';

	// The second select box lists all the boards in the category.
	echo '
							<select id="board_order" name="board_order" ', isset($context['board']['is_new']) ? '' : 'disabled="disabled"', '>
								', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '';
	foreach ($context['board_order'] as $order)
		echo '
								<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
	echo '
							</select>
						</dd>';
	}]]></search>
	<add><![CDATA[// If this isn't the only board in this category let the user choose where the board is to live.
	foreach ($context['board_order'] as $cat => $board_order)
	{
		if ((isset($context['board']['is_new']) && count($board_order) > 0) || count($board_order) > 1)
		{
			echo '
						<dt id="cat_txt', $cat, '"', ($cat != $context['board']['category'] ? ' style="display: none;"' : '') . '>
							<strong>', $txt['order'], ':</strong>
						</dt>
						<dd id="cat_opt', $cat, '"', ($cat != $context['board']['category'] ? ' style="display: none;"' : '') . '>';

			// The first select box gives the user the option to position it before, after or as a child of another board.
			echo '
							<select id="order" name="placement', $cat, '">
								', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '', '
								<option value="after">' . $txt['mboards_order_after'] . '...</option>
								<option value="child">' . $txt['mboards_order_child_of'] . '...</option>
								<option value="before">' . $txt['mboards_order_before'] . '...</option>
							</select>';

			// The second select box lists all the boards in the category.
			echo '
							<select id="board_order', $cat, '" name="board_order', $cat, '" ', isset($context['board']['is_new']) ? '' : 'disabled="disabled"', '>
								', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '';
			foreach ($board_order as $order)
				echo '
								<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
			echo '
							</select>
						</dd>';
		}
	}]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[foreach ($context['category_order'] as $cat)]]></search>
		<add><![CDATA[foreach ($context['category_order'][$_POST['forumid']] as $cat)]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<label for="delete_action1"><input type="radio" id="delete_action1" name="delete_action" value="1" class="input_radio"', count($context['category_order']) == 1 ? ' disabled="disabled"' : '', ' />', $txt['mboards_delete_option2'], '</label>:]]></search>
		<add><![CDATA[<label for="delete_action1"><input type="radio" id="delete_action1" name="delete_action" value="1" class="input_radio"', count($context['category_order'][$_POST['forumid']]) == 1 ? ' disabled="disabled"' : '', ' />', $txt['mboards_delete_option2'], '</label>:]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// If this isn't the only category, let the user choose where this category should be positioned down the board index.
	if (count($context['category_order']) > 1)
	{
		echo '
						<dt><strong>', $txt['order'], ':</strong></dt>
						<dd>
							<select name="cat_order">';
		// Print every existing category into a select box.
		foreach ($context['category_order'] as $order)
			echo '
								<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
		echo '
							</select>
						</dd>';
	}]]></search>
		<add><![CDATA[// If this isn't the only category, let the user choose where this category should be positioned down the board index.
	foreach ($subforum_tree as $id => $subforum)
	{
		if (isset($context['category_order'][$subforum['forumid']]) && count($context['category_order'][$subforum['forumid']]) > 1)
		{
			echo '
						<dt id="cat_txt' . $subforum['forumid'] . '">
							<strong>', $txt['order'], ':</strong>
						</dt>
						<dd id="cat_ord' . $subforum['forumid'] . '">
							<select name="cat_order' . $subforum['forumid'] . '" id="cat_order' . $subforum['forumid'] . '"' . ($subforum['forumid'] <> $_REQUEST['sub'] ? ' style="display: none;"' : '') . '>';

			// Print every existing category into a select box.
			foreach ($context['category_order'][$subforum['forumid']] as $order)
				echo '
									<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
			echo '
							</select>';
		}
		echo '
						</dd>';
	}]]></add>
	</operation>
	<operation error="ignore">
		<search position="replace"><![CDATA[</dt>
							<dd>
								<select name="alias_cat[]" multiple="multiple">
									<option value="">', $txt['no_cat_selected'], '</option>';
	foreach ($cat_tree as $category)
		echo '
									<option', !isset($context['board']['is_new']) && in_array($category['node']['id'], $context['board']['alias_cat']) ? ' selected="selected"' : '', ' value="', $category['node']['id'], '">', $category['node']['name'], '</option>';
	echo '
								</select>
							</dd>]]></search>
		<add><![CDATA[</dt>';
	foreach ($subforum_tree as $id => $subforum)
	{
		echo '
							<dd id="alias_cat', $id, '"', ($_REQUEST['sub'] != $id ? ' style="display: none;"' : '') . '>
								<select name="alias_cat' . $id . '[]" multiple="multiple">
									<option value="">', $txt['no_cat_selected'], '</option>';
		foreach ($cat_tree as $category)
			if ($category['node']['forumid'] == $id)
				echo '
									<option', !isset($context['board']['is_new']) && in_array($category['node']['id'], $context['board']['alias_cat']) ? ' selected="selected"' : '', ' value="', $category['node']['id'], '">', $category['node']['name'], '</option>';
		echo '
								</select>
							</dd>';]]></add>
	</operation>
	<operation error="ignore">
		<search position="replace"><![CDATA[</dt>
							<dd>
								<select name="alias_child[]" multiple="multiple">
									<option value="">', $txt['no_boards_selected'], '</option>';
		foreach ($boards as $board)
			echo '
									<option', !isset($context['board']['is_new']) && in_array($board['id'], $context['board']['alias_child']) ? ' selected="selected"' : '', ' value="', $board['id'], '">', $board['name'], '</option>';
	echo '
								</select>
							</dd>]]></search>
		<add><![CDATA[</dt>';
	foreach ($subforum_tree as $id => $subforum)
	{
		echo '
							<dd id="alias_child', $id, '"', ($_REQUEST['sub'] != $id ? ' style="display: none;"' : '') . '>
								<select name="alias_child' . $id . '[]" multiple="multiple">
									<option value="">', $txt['no_boards_selected'], '</option>';
		foreach ($boards as $board)
		{
			if ($cat_tree[$board['category']]['node']['forumid'] == $id)
				echo '
									<option', !isset($context['board']['is_new']) && in_array($board['id'], $context['board']['alias_child']) ? ' selected="selected"' : '', ' value="', $board['id'], '">', $board['name'], '</option>';
		}
		echo '
								</select>
							</dd>';
	}
	echo ']]></add>
	</operation>
</file>

<!-------------------------------------------------------------------------->
<!-- Simple Portal block management (PortalAdminBlocks.template.php)      -->
<!-------------------------------------------------------------------------->
<file name="$themedir/PortalAdminBlocks.template.php" error="skip">
	<operation>
		<search position="before"><![CDATA[global $context, $settings, $options, $scripturl, $txt, $helptxt, $modSettings]]></search>
		<add><![CDATA[, $forumid, $subforum_tree]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[global $context, $settings, $options, $scripturl, $txt;]]></search>
		<add><![CDATA[global $context, $settings, $options, $scripturl, $txt, $subforum_tree;]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<div id="sp_manage_blocks">';]]></search>
		<add><![CDATA[<script type="text/javascript"><!-- // --><![CDATA[<]]><![CDATA[![CDATA[
		function expandTabs(forum)
		{
			';
	foreach ($subforum_tree as $subforum => $info)
		echo 'document.getElementById("subforum' . $subforum . '").style.display = (forum == ' . $subforum . ' ? "" : "none");
			document.getElementById("tab' . $subforum . '").className = (forum == ' . $subforum . ' ? "tabActiveHeader" : "");
			';
	echo '
		}
	// ]]]]><![CDATA[></script>
	<div id="sp_manage_blocks">';]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<p>', $context['move_title'], ' [<a href="', $scripturl, '?action=admin;area=portalblocks">', $txt['sp-blocks_cancel_moving'], '</a>]', '</p>]]></search>
		<add><![CDATA[<p>', $context['move_title'], ' [<a href="', $scripturl, '?action=admin;area=portalblocks;sub=' . $context['req_forumid'] , '">', $txt['sp-blocks_cancel_moving'], '</a>]', '</p>]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<a class="sp_float_right" href="', $scripturl, '?action=admin;area=portalblocks;sa=add;col=', $side['id'], '">', sp_embed_image('add', sprintf($txt['sp-blocksCreate'], $side['label'])), '</a>
				<a href="', $scripturl, '?action=helpadmin;help=', $side['help'], '" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="icon" /></a>
				<a href="', $scripturl, '?action=admin;area=portalblocks;sa=', $id, '">', $side['label'], ' ', $txt['sp-blocksBlocks'], '</a>]]></search>
		<add><![CDATA[<a class="sp_float_right" href="', $scripturl, '?action=admin;area=portalblocks;sa=add;sub=' . $context['req_forumid'] , ';col=', $side['id'], '">', sp_embed_image('add', sprintf($txt['sp-blocksCreate'], $side['label'])), '</a>
				<a href="', $scripturl, '?action=helpadmin;help=', $side['help'], '" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="icon" /></a>
				<a href="', $scripturl, '?action=admin;area=portalblocks;sub=' . $context['req_forumid'] , ';sa=', $id, '">', $side['label'], ' ', $txt['sp-blocksBlocks'], '</a>]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<td class="sp_center"><a href="', $scripturl, '?action=admin;area=portalblocks;sa=move;block_id=', $context['block_move'], ';col=', $side['id'], ';', $context['session_var'], '=', $context['session_id'], '">', sp_embed_image('arrow', $txt['sp-blocks_move_here']), '</a></td>]]></search>
		<add><![CDATA[<td class="sp_center"><a href="', $scripturl, '?action=admin;area=portalblocks;sub=' . $context['req_forumid'] , ';sa=move;block_id=', $context['block_move'], ';col=', $side['id'], ';', $context['session_var'], '=', $context['session_id'], '">', sp_embed_image('arrow', $txt['sp-blocks_move_here']), '</a></td>]]></add>
	</operation>
	<operation>
		<search position="after"><![CDATA[foreach($context['sides'] as $id => $side)]]></search>
		<add><![CDATA[// Display the subforums as a tab at the top of the screen:
	$flagged = array( 0 => false );
	if (count($subforum_tree) > 1)
	{
		echo '
		<div id="tabContainer">
			<div class="tabs">
				<ul>';
		foreach ($subforum_tree as $id => $section)
		{
			echo '
					<li', ($id == $context['req_forumid'] ? ' class="tabActiveHeader"' : ''), '><a href="', $scripturl, '?action=admin;area=portalblocks;sub=', $id, (empty($_REQUEST['sa']) ? '' : ';sa=' . $_REQUEST['sa']), '">', (isset($section['boardname']) ? $section['boardname'] : '# '.$section['forumid']), '</a></li>';
			$flagged[$id] = false;
		}
		echo '
				</ul>
			</div>
		</div><hr/>';
	}

	]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<form name="sp_edit_block_form" id="sp_edit_block_form" action="', $scripturl, '?action=admin;area=portalblocks;sa=edit" method="post" accept-charset="', $context['character_set'], '" onsubmit="submitonce(this);">]]></search>
		<add><![CDATA[<form name="sp_edit_block_form" id="sp_edit_block_form" action="', $scripturl, '?action=admin;area=portalblocks;sub=' . $context['req_forumid'] , ';sa=edit" method="post" accept-charset="', $context['character_set'], '" onsubmit="submitonce(this);">]]></add>
	</operation>
	<operation>
		<search position="after"><![CDATA[', $txt['sp-blocksShowBlock'], ']]></search>
		<add><![CDATA[';
		if (count($subforum_tree) > 1)
		{
			echo $txt['sp-subforums'], ':
					<select name="forum" id="forum" onchange="sp_hideBoards(this.options[this.selectedIndex].value);">';
			foreach ($subforum_tree as $subforum)
				echo '
						<option value="', $subforum['forumid'], '"', ($context['req_forumid'] == $subforum['forumid']  ? ' selected="selected"' : ''), '>', $subforum['boardname'], '</option>';
			echo '
					</select><br/>';
		}
		else
			echo '
					<input type="hidden" name="forum" value="', $forumid, '" />';
		echo '
					]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[$display_types = array('actions', 'boards', 'pages');
		foreach ($display_types as $type)
		{
			if (empty($context['display_' . $type]))
				continue;]]></search>
		<add><![CDATA[$display_types = array('actions');
		foreach ($subforum_tree as $subforum)
			$display_types[] = 'boards' . $subforum['forumid'];
		$display_types[] = 'pages';
		foreach ($display_types as $type)
		{
			if (empty($context['display_' . $type]))
				continue;
			if ($need_div = empty($txt['sp-blocksSelect' . ucfirst($type)]))
			{
				$txt['sp-blocksSelect' . ucfirst($type)] = $txt['sp-blocksSelectBoards'];
				echo '
						<div id="sfm_', $type, '" name="sfm_', $type, '"', $context['SPortal']['block']['forum'] <> str_replace('boards', '', $type) ? ' style="display: none;"' : '', '>';
			}]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[<li><input type="checkbox" onclick="invertAll(this, this.form, \'display_', $type, '[]\');" class="input_check" /> <em>', $txt['check_all'], '</em></li>
						</ul>
						<br />';]]></search>
		<add><![CDATA[
			if ($need_div)
				echo '
						</div>';]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<form action="', $scripturl, '?action=admin;area=portalblocks;sa=add" method="post" accept-charset="', $context['character_set'], '">]]></search>
		<add><![CDATA[<form action="', $scripturl, '?action=admin;area=portalblocks;sub=' . $context['req_forumid'] , ';sa=add" method="post" accept-charset="', $context['character_set'], '">]]></add>
	</operation>
</file>
<file name="$themedir/index.template.php">
	<operation>
		<search position="replace"><![CDATA[function template_html_above()
{
	global $context, $settings, $options, $scripturl, $txt, $modSettings;]]></search>
		<add><![CDATA[function template_html_above()
{
	global $context, $settings, $options, $scripturl, $txt, $modSettings, $favicon;]]></add>
	</operation>
	<operation>
		<search position="after"><![CDATA[
</head>]]></search>
		<add><![CDATA[';
	if (!empty($favicon))
		echo '<link rel="shortcut icon" href="'.$favicon.'" type="image/x-icon" />
<link rel="icon" href="'.$favicon.'" type="image/x-icon" />';
echo '
]]></add>
	</operation>
</file>
</modification>