<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>Dougiefresh:Split_Forum</id>
<version>1.29</version>

<file name="$themedir/ManageBoards.template.php">
	<operation>
		<search position="replace"><![CDATA[// Below is the template for adding/editing an board on the forum.
, $forumid, $subforum_tree]]></search>
		<add><![CDATA[// Below is the template for adding/editing an board on the forum.
function template_modify_board()
{
	global $context, $scripturl, $txt, $modSettings, $forumid, $subforum_tree]]></add>
	</operation>
</file>
<file name="$sourcedir/Recent.php">
	<operation>
		<search position="replace"><![CDATA[			fatal_lang_error('wrong_forum', false);

		$query_this_board = 'id_board IN ({array_int:boards})';]]></search>
		<add><![CDATA[			fatal_lang_error('error_no_boards_selected');

		$query_this_board = 'b.id_board IN ({array_int:boards})';]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[			fatal_lang_error('wrong_forum', false);

		$query_this_board = 'id_board IN ({array_int:boards})';]]></search>
		<add><![CDATA[			fatal_lang_error('error_no_boards_selected');

		$query_this_board = 'id_board IN ({array_int:boards})';]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[			fatal_lang_error('wrong_forum', false);

		$query_this_board = 'id_board IN ({array_int:boards})';]]></search>
		<add><![CDATA[			fatal_lang_error('error_no_boards_selected');

		$query_this_board = 'id_board IN ({array_int:boards})';]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[			fatal_lang_error('wrong_forum', false);

		$query_this_board = 'id_board IN ({array_int:boards})';]]></search>
		<add><![CDATA[			fatal_lang_error('error_no_boards_selected');

		$query_this_board = 'id_board IN ({array_int:boards})';]]></add>
	</operation>
</file>
<file name="$sourcedir/EzPortal2.php" error="skip">
	<operation>
		<search position="before"><![CDATA[l.customtitle, l.id_layout, l.active, l.id_order  ]]></search>
		<add><![CDATA[, l.forum]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[while($row2 = $smcFunc['db_fetch_assoc']($dbresult2))
			$blocks[] = $row2;]]></search>
		<add><![CDATA[while($row2 = $smcFunc['db_fetch_assoc']($dbresult2))
			$blocks[$row2['forum']][] = $row2;]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[$settings, $disableEzPortal, $modSettings]]></search>
		<add><![CDATA[, $forumid]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[WHERE l.active = 1 AND l.id_column = " . $row['id_column'] . " ]]></search>
		<add><![CDATA[
				AND l.forum = " . ((int) $forumid) . "]]></add>
	</operation>
	<operation>
		<search position="before><![CDATA[(id_column, id_block, id_order, customtitle, permissions, blockmanagers, can_collapse, active, blockdata, id_icon, hidetitlebar]]></search>
		<add><![CDATA[, forum]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[// Insert the ezBlock]]></search>
		<add><![CDATA[
	$forum = (int) $_REQUEST['sub'];]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[VALUES ($column, $blocktype,1000,'$blocktitle','$finalPermissions','$finalManagers',$can_collapse, 1,'$blockdata','$icon', $hidetitlebar]]></search>
		<add><![CDATA[, $forum]]></add>
	</operation>
</file>
<file name="$sourcedir/Subs-EzPortalMain2.php" error="skip">
	<operation>
		<search position="before"><![CDATA[function EzBlockRecentPostsBlock($paramters = array(), $numPosts = 10, $exclude_boards = null, $format = 'vertical', $startHtml = '', $endHtml = '')
{

	global $context, $settings, $scripturl, $txt, $smcFunc]]></search>
		<add><![CDATA[, $forumid]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[m.ID_MSG >= " . ($modSettings['maxMsgID'] - 2000 * min($numPosts, 5)) . " AND ]]></search>
		<add><![CDATA[
			c.forumid = " . ((int) $forumid) . " AND]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[function EzBlockRecentTopicsBlock($paramters = array(), $numTopics = 10, $exclude_boards = null, $format = 'vertical', $startHtml = '', $endHtml = '')
{
	global $context, $settings, $scripturl, $txt, $smcFunc]]></search>
		<add><![CDATA[, $forumid]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[FROM ({db_prefix}messages AS m, {db_prefix}topics AS t, {db_prefix}boards AS b, {db_prefix}messages AS ms)]]></search>
		<add><![CDATA[
			LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[m.ID_MSG >= " . ($modSettings['maxMsgID'] - 2000 * min($numTopics, 5)) . " AND ]]></search>
		<add><![CDATA[
			c.forumid = " . ((int) $forumid) . " AND]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[function EzBlockPollBlock($paramters = array(), $pollTopicID = 0, $startHtml = '', $endHtml = '')
{
	global $smcFunc, $txt, $settings, $boardurl, $sc, $user_info]]></search>
		<add><![CDATA[, $forumid]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[WHERE p.ID_POLL = t.ID_POLL]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)
		WHERE p.ID_POLL = t.ID_POLL
			AND c.forumid = " . ((int) $forumid) . "]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[FROM ({db_prefix}messages AS m, {db_prefix}boards AS b)]]></search>
		<add><![CDATA[
			LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)]]></add>
	</operation>
</file>
<file name="$themedir/EzPortal2.template.php" error="skip">
	<operation>
		<search position="before"><![CDATA[function template_ezportal_blocks()
{
	global $context, $txt, $scripturl, $ezpSettings]]></search>
		<add><![CDATA[, $forumid, $subforum_tree]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[
        </h3>
  </div>]]></search>
		<add><![CDATA[
	<script type="text/javascript"><!-- // --><![CDATA[<]]><![CDATA[![CDATA[
		function expandTabs(forum)
		{
			';
	foreach ($subforum_tree as $subforum => $info)
		echo 'document.getElementById("subforum' . $subforum . '").style.display = (forum == ' . $subforum . ' ? "" : "none");
			document.getElementById("tab' . $subforum . '").className = (forum == ' . $subforum . ' ? "tabActiveHeader" : "");
			';
	echo '
		}
	// ]]]]><![CDATA[></script>';

	// Display the subforums as a tab at the top of the screen:
	if (count($subforum_tree) > 1)
	{
		echo '
		<div id="tabContainer">
			<div class="tabs">
				<ul>';
		foreach ($subforum_tree as $id => $section)
			echo '
					<li', ($id == $context['req_forumid'] ? ' class="tabActiveHeader"' : ''), ' id="tab' . $id . '"><a href="javascript:void(0);" onclick="expandTabs(' . $id . '); return false;">', (isset($section['boardname']) ? $section['boardname'] : '# '.$section['forumid']), '</a></li>';
		echo '
				</ul>
			</div>
		</div>';
	}
	foreach ($subforum_tree as $sub => $data)
	{
	echo '
<div id="subforum' . $sub . '"' . ($sub <> $forumid ? ' style="display: none;"' : '') . '>]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[<form method="post" action="', $scripturl, '?action=ezportal;sa=blocks2]]></search>
		<add><![CDATA[;sub=' . $sub . ']]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[<a href="', $scripturl, '?action=admin;area=ezpblocks;sa=addblock;column=',$row['id_column'],']]></search>
		<add><![CDATA[;sub=' . $sub . ']]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[foreach($row['blocks'] as $blockRow)]]></search>
		<add><![CDATA[$blocks = isset($row['blocks'][$sub]) ? $row['blocks'][$sub] : array();
					foreach($blocks as $blockRow)]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[</table>';


}

function template_ezportal_import()]]></search>
		<add><![CDATA[</table>
</div>';
}

}

function template_ezportal_import()]]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[<form method="post" name="frmaddblock" id="frmaddblock" action="', $scripturl, '?action=admin;area=ezpblocks;sa=addblock2]]></search>
		<add><![CDATA[;sub=' . ((int) $_REQUEST['sub']) . ']]></add>
	</operation>
	<operation>
		<search position="before"><![CDATA[<form method="post" name="frmaddblock" id="frmaddblock" action="', $scripturl, '?action=ezportal;sa=addblock3]]></search>
		<add><![CDATA[;sub=' . ((int) $_REQUEST['sub']) . ']]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<td width="80%"  class="windowbg2"><a href="', $scripturl, '?action=admin;area=ezpblocks;sa=visiblesettings;column=',$context['ezp_column_data']['id_column'],'">',$txt['ezp_txt_update_visible_options'],'</a></td>]]></search>
		<add><![CDATA[<td width="80%"  class="windowbg2"><a href="', $scripturl, '?action=admin;area=ezpblocks;sa=visiblesettings;column=',$context['ezp_column_data']['id_column'],';sub=' . ((int) $_REQUEST['sub']) . '">',$txt['ezp_txt_update_visible_options'],'</a></td>]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<td width="80%"  class="windowbg2"><a href="', $scripturl, '?action=admin;area=ezpblocks;sa=visiblesettings;block=',$context['ezp_block_info']['id_layout'],'">',$txt['ezp_txt_update_visible_options'],'</a></td>]]></search>
		<add><![CDATA[<td width="80%"  class="windowbg2"><a href="', $scripturl, '?action=admin;area=ezpblocks;sa=visiblesettings;block=',$context['ezp_block_info']['id_layout'],';sub=' . ((int) $_REQUEST['sub']) . '">',$txt['ezp_txt_update_visible_options'],'</a></td>]]></add>
	</operation>
</file>
</modification>