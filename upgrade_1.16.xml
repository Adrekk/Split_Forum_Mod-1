<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>Dougiefresh:Split_Forum</id>
<version>1.16</version>

<!---------------------------------------------------------------------------->
<!-- Fix for SSI bug report by SauloA										-->
<!---------------------------------------------------------------------------->
<file name="$boarddir/SSI.php">
	<operation>
		<search position="replace"><![CDATA[SELECT t.id_first_msg
		FROM {db_prefix}topics as t
			INNER JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)
			LEFT JOIN {db_prefix}boards as b ON (b.id_board = t.id_board)
		WHERE t.id_board = {int:current_board}' . ($modSettings['postmod_active'] ? ']]></search>
		<add><![CDATA[SELECT t.id_first_msg
		FROM {db_prefix}topics as t
			LEFT JOIN {db_prefix}boards as b ON (b.id_board = t.id_board)
			INNER JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)
		WHERE t.id_board = {int:current_board}' . ($modSettings['postmod_active'] ? ']]></add>
	</operation>
</file>

<!---------------------------------------------------------------------------->
<!-- Security issue fixes for this mod, Part 1								-->
<!---------------------------------------------------------------------------->
<file name="$sourcedir/Display.php">
	<operation>
		<search position="replace"><![CDATA['forumid' => $forumid,]]></search>
		<add><![CDATA['forumid' => (int) $forumid,]]></add>
	</operation>
</file>

<!---------------------------------------------------------------------------->
<!-- Modification for Pretty URLs compatibility	(Load.php)					-->
<!---------------------------------------------------------------------------->
<file name="$sourcedir/Load.php">
	<operation>
		<search position="replace"><![CDATA[// Replace certain settings with the Subforum setting if available:]]></search>
		<add><![CDATA[// Overwrite certain settings with the Subforum setting if available:
	$modSettings['pretty_root_url'] = $subforum_tree[$forumid]['boardurl'];]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// Define primary subforum entry if it is not already defined:
	global $cookiename, $boardurl, $mbname, $language, $boarddir;]]></search>
		<add><![CDATA[// Define primary subforum entry if it is not already defined:]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[global $board_info, $board, $topic, $user_info, $smcFunc;]]></search>
		<add><![CDATA[global $board_info, $board, $topic, $user_info, $smcFunc, $subforum_tree;]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['cookiename' => $cookiename,
				'boardurl' => $boardurl,]]></search>
		<add><![CDATA['boardurl' => $boardurl,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[$forumid = $row['forumid'];]]></search>
		<add><![CDATA[$forumid = (int) $row['forumid'];]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[$favicon = $row['favicon'];
			break;]]></search>
		<add><![CDATA[$favicon = $row['favicon'];]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[}
	$forumid = (int) $forumid;]]></search>
		<add><![CDATA[}]]></add>
	</operation>

<!---------------------------------------------------------------------------->
<!-- Fix for Undefined array element report by SauloA						-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[$check = (($test1 == $host || $test2 == $host) && $url['path'] == $uri);
		if (!empty($row['sp_standalone']))]]></search>
		<add><![CDATA[$check = ($test1 == $host || $test2 == $host);
		if (isset($url['path']))
			$check = $check && (strpos($uri, substr($url['path'], 1)) > 0);
		if (!$check && !empty($row['sp_standalone']))]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[$check = $check || (($test1 == $host || $test2 == $host) && $url['path'] == $uri);]]></search>
		<add><![CDATA[$check = ($test1 == $host || $test2 == $host);
			if (isset($url['path']))
				$check = ($check && $url['path'] == $uri);]]></add>
	</operation>

<!---------------------------------------------------------------------------->
<!-- Appearance-related modification of the ManageBoards.php file			-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[if ((int)$row['forumid'] != $forumid) {
				// Find the right subforum to redirect to:
				global $subforum_tree;]]></search>
		<add><![CDATA[// Find the right subforum to redirect to:
			if ((int) $row['forumid'] != $forumid)
			{]]></add>
	</operation>
</file>

<!---------------------------------------------------------------------------->
<!-- Bug fix for Modify Board UI (ManageBoards.php)							-->
<!---------------------------------------------------------------------------->
<file name="$sourcedir/ManageBoards.php">
	<operation>
		<search position="replace"><![CDATA[$sub = (!empty($_POST['new_forum']) ? $_POST['new_forum'] : $forumid);
		
		// Move this board to a new category?
		$cat = (!empty($_GET['cat']) ? $_GET['cat'] : '');
		if (!empty($_POST['new_cat' . $sub]))
		{
			$boardOptions['move_to'] = 'bottom';
			$boardOptions['target_category'] = $cat = (int) $_POST['new_cat' . $sub];]]></search>
		<add><![CDATA[$sub = (!empty($_POST['new_forum']) ? $_POST['new_forum'] : $forumid);
		$cat = (!empty($_POST['new_cat' . $sub]) ? $_POST['new_cat' . $sub] : '');
		
		// Move this board to a new category?
		if (!empty($cat))
		{
			$boardOptions['move_to'] = 'bottom';
			$boardOptions['target_category'] = $cat;]]></add>
	</operation>
	
<!---------------------------------------------------------------------------->
<!-- Security issue fixes for this mod, Part 2								-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')
		WHERE redirect = {string:empty_string}',
		array(]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid}')
		WHERE redirect = {string:empty_string}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/ManageCalendar.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')',
		array(]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/ManageMaintenance.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')
		WHERE {query_see_board}
			AND redirect = {string:blank_redirect}',
		array(]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})
		WHERE {query_see_board}
			AND redirect = {string:blank_redirect}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/News.php">
	<operation>
		<search position="replace"><![CDATA['is_approved' => 1,
			'forumid' => $forumid,]]></search>
		<add><![CDATA['is_approved' => 1,
				'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['optimize_msg' => $optimize_msg,
				'forumid' => $forumid,]]></search>
		<add><![CDATA['optimize_msg' => $optimize_msg,
				'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/Post.php">
	<operation>
		<search position="replace"><![CDATA[AND forumid = {int:forumid}
				LIMIT 1',
				array(
					'id_event' => $context['event']['id'],
					'forumid' => $forumid,]]></search>
		<add><![CDATA[AND forumid = {int:forumid}
				LIMIT 1',
				array(
					'id_event' => $context['event']['id'],
					'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[SELECT id_member
				FROM {db_prefix}calendar
				WHERE id_event = {int:id_event}
					AND forumid = {int:forumid}',
				array(
					'id_event' => $_REQUEST['eventid'],
					'forumid' => $forumid,]]></search>
		<add><![CDATA[SELECT id_member
				FROM {db_prefix}calendar
				WHERE id_event = {int:id_event}
					AND forumid = {int:forumid}',
				array(
					'id_event' => $_REQUEST['eventid'],
					'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[DELETE FROM {db_prefix}calendar
				WHERE id_event = {int:id_event}
					AND forumid = {int:forumid}',
				array(
					'id_event' => $_REQUEST['eventid'],
					'forumid' => $forumid,]]></search>
		<add><![CDATA[DELETE FROM {db_prefix}calendar
				WHERE id_event = {int:id_event}
					AND forumid = {int:forumid}',
				array(
					'id_event' => $_REQUEST['eventid'],
					'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[AND forumid = {int:forumid}',
				array(
					'forumid' => $forumid,]]></search>
		<add><![CDATA[AND forumid = {int:forumid}',
				array(
					'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/PostModeration.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[LIMIT ' . $context['start'] . ', 10',
		array(
			'not_approved' => 0,
		)]]></search>
		<add><![CDATA[LIMIT ' . $context['start'] . ', 10',
		array(
			'forumid' => (int) $forumid,
			'not_approved' => 0,
		)]]></add>
	</operation>
</file>
<file name="$sourcedir/Profile-Modify.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')
		WHERE {query_see_board}
			AND redirect = {string:empty_string}',
		array(]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})
		WHERE {query_see_board}
			AND redirect = {string:empty_string}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
</file>

<!---------------------------------------------------------------------------->
<!-- Modification to properly support Recent Posts per Subforum				-->
<!---------------------------------------------------------------------------->
<file name="$sourcedir/Recent.php">
	<operation>
		<search position="replace"><![CDATA[WHERE id_cat = {int:id_cat}
				LIMIT 1',
				array(]]></search>
		<add><![CDATA[WHERE id_cat = {int:id_cat}
					AND forumid = {int:forumid}
				LIMIT 1',
				array(
					'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[FROM {db_prefix}boards AS b
			WHERE b.id_cat IN ({array_int:category_list})
				AND {query_see_board}',
			array(
				'category_list' => $_REQUEST['c'],]]></search>
		<add><![CDATA[FROM {db_prefix}boards AS b
				LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)
			WHERE b.id_cat IN ({array_int:category_list})
				AND c.forumid = {int:forumid}
				AND {query_see_board}',
			array(
				'forumid' => (int) $forumid,
				'category_list' => $_REQUEST['c'],]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[FROM {db_prefix}boards AS b
			WHERE b.id_board IN ({array_int:board_list})
				AND {query_see_board}
			LIMIT {int:limit}',
			array(
				'board_list' => $_REQUEST['boards'],]]></search>
		<add><![CDATA[FROM {db_prefix}boards AS b
				LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)
			WHERE b.id_board IN ({array_int:board_list})
				AND c.forumid = {int:forumid}
				AND {query_see_board}
			LIMIT {int:limit}',
			array(
				'forumid' => (int) $forumid,
				'board_list' => $_REQUEST['boards'],]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[FROM {db_prefix}boards
			WHERE id_board = {int:current_board}
			LIMIT 1',
			array(
				'current_board' => $board,]]></search>
		<add><![CDATA[FROM {db_prefix}boards
				LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)
			WHERE id_board = {int:current_board}
				AND c.forumid = {int:forumid}
			LIMIT 1',
			array(
				'forumid' => (int) $forumid,
				'current_board' => $board,]]></add>
	</operation>

<!---------------------------------------------------------------------------->
<!-- Bug Fix for issue noticed during modification of Recent Posts code		-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[INNER JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_Cat)]]></search>
		<add><![CDATA[INNER JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat)]]></add>
	</operation>

<!---------------------------------------------------------------------------->
<!-- SQL alignment fix for Recent Posts code								-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[INNER JOIN {db_prefix}boards AS b ON (b.id_board = m.id_board)
			INNER JOIN {db_prefix}categories AS c ON (b.id_cat = c.id_cat)]]></search>
		<add><![CDATA[INNER JOIN {db_prefix}boards AS b ON (b.id_board = m.id_board)
					INNER JOIN {db_prefix}categories AS c ON (b.id_cat = c.id_cat)]]></add>
	</operation>

<!---------------------------------------------------------------------------->
<!-- Security issue fixes for this mod, Part 3								-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA['recycle_board' => $modSettings['recycle_board'],
			'is_approved' => 1,
			'forumid' => $forumid,]]></search>
		<add><![CDATA['recycle_board' => $modSettings['recycle_board'],
			'is_approved' => 1,
			'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['limit' => 10,
					'forumid' => $forumid,]]></search>
		<add><![CDATA['limit' => 10,
					'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['no_child' => 0,
				'boards' => $boards,
				'forumid' => $forumid,]]></search>
		<add><![CDATA['no_child' => 0,
				'boards' => $boards,
				'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['board_list' => $_REQUEST['boards'],
				'forumid' => $forumid,]]></search>
		<add><![CDATA['board_list' => $_REQUEST['boards'],
				'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['id_cat' => $_REQUEST['c'],
				'forumid' => $forumid,]]></search>
		<add><![CDATA['id_cat' => $_REQUEST['c'],
				'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['recycle_board' => (int) $modSettings['recycle_board'],
				'forumid' => $forumid]]></search>
		<add><![CDATA['recycle_board' => (int) $modSettings['recycle_board'],
				'forumid' => (int) $forumid]]></add>
	</operation>
</file>
<file name="$sourcedir/RemoveTopic.php">
	<operation>
		<search position="replace"><![CDATA['forumid' => $forumid,]]></search>
		<add><![CDATA['forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/Reports.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['name' => 'name',]]></search>
		<add><![CDATA['name' => 'name',
			'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/Search.php">
	<operation>
		<search position="replace"><![CDATA[INNER JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')]]></search>
		<add><![CDATA[INNER JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['message_list' => $msg_list,
				'is_approved' => 1,]]></search>
		<add><![CDATA['message_list' => $msg_list,
				'is_approved' => 1,
				'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/SplitTopics.php">
	<operation>
		<search position="replace"><![CDATA['forumid' => $forumid,]]></search>
		<add><![CDATA['forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/Subs-BoardIndex.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA['current_member' => $user_info['id'],]]></search>
		<add><![CDATA['forumid' => (int) $forumid,
			'current_member' => $user_info['id'],]]></add>
	</operation>
</file>
<file name="$sourcedir/Subs-Boards.php">
	<operation>
		<search position="replace"><![CDATA['forumid' => $forumid,]]></search>
		<add><![CDATA['forumid' => (int) $forumid,]]></add>
	</operation>

<!---------------------------------------------------------------------------->
<!-- Modification to call a function to remove bad aliases (duh)			-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[// Set moderators of this board.]]></search>
		<add><![CDATA[// Edit the aliases to make sure they are valid for this subforum:
	if (array_key_exists('alias_child', $boardOptions))
	{
		require_once($sourcedir . '/Subs-ManageSplitForums.php');
		remove_bad_aliases();
	}

	// Set moderators of this board.]]></add>
	</operation>
</file>

<!---------------------------------------------------------------------------->
<!-- Security issue fixes for this mod, Part 4								-->
<!---------------------------------------------------------------------------->
<file name="$sourcedir/Subs-Calendar.php">
	<operation>
		<search position="replace"><![CDATA[AND cal.forumid = {int:forumid}',
		array(
			'forumid' => $forumid,]]></search>
		<add><![CDATA[AND cal.forumid = {int:forumid}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[LIMIT 1',
		array(
			'forumid' => $forumid,]]></search>
		<add><![CDATA[LIMIT 1',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[id_topic = {int:id_topic}
		WHERE id_event = {int:id_event}
			AND forumid = {int:forumid}',
		array(
			'forumid' => $forumid,]]></search>
		<add><![CDATA[id_topic = {int:id_topic}
		WHERE id_event = {int:id_event}
			AND forumid = {int:forumid}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[DELETE FROM {db_prefix}calendar
		WHERE id_event = {int:id_event}
			AND forumid = {int:forumid}',
		array(
			'forumid' => $forumid,]]></search>
		<add><![CDATA[DELETE FROM {db_prefix}calendar
		WHERE id_event = {int:id_event}
			AND forumid = {int:forumid}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}topics AS t ON (t.id_topic = c.id_topic)
		WHERE c.id_event = {int:id_event}
			AND c.forumid = {int:forumid}',
		array(
			'forumid' => $forumid,]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}topics AS t ON (t.id_topic = c.id_topic)
		WHERE c.id_event = {int:id_event}
			AND c.forumid = {int:forumid}',
		array(
			'forumid' => (int) $forumid,]]></add>
	</operation>
</file>
<file name="$sourcedir/Subs-MessageIndex.php">
	<operation>
		<search position="replace"><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = '.$forumid.')]]></search>
		<add><![CDATA[LEFT JOIN {db_prefix}categories AS c ON (c.id_cat = b.id_cat AND c.forumid = {int:forumid})]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[$where_parameters = array();]]></search>
		<add><![CDATA[$where_parameters = array('forumid' => (int) $forumid);]]></add>
	</operation>
</file>

<!---------------------------------------------------------------------------->
<!-- Modification of Edit Category UI (ManageBoards.template.php) 			-->
<!---------------------------------------------------------------------------->
<file name="$themedir/ManageBoards.template.php">
	<operation>
		<search position="replace"><![CDATA[// If this isn't the only subforum, let the user choose which subforum it should be placed in:
	if (count($subforum_tree) > 1)
	{
		echo '
						<dt>
							<strong>' . $txt['forumid_title']. '</strong><br />
							<span class="smalltext">' . $txt['forumid_desc'] . '</span>
						</dt>
						<dd>
							<select name="forum_id" onchange="SubForumsCategories(this.options[this.selectedIndex].value); return false;">';
		// Print every existing category into a select box.
		foreach ($subforum_tree as $row)
			echo '
								<option', $context['category']['forumid'] == $row['forumid'] ? ' selected="selected"' : '', ' value="', $row['forumid'], '">', $row['boardname'], '</option>';
		echo '
							</select>
						</dd>';
	} else {
		echo '
						<input type="hidden" name="forum_id" value="', $forumid, '" size="4" tabindex="', $context['tabindex']++, '" />';
	}


	// Table footer.]]></search>
		<add><![CDATA[
	// Table footer.]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[// If this isn't the only category, let the user choose where this category should be positioned down the board index.
	foreach ($subforum_tree as $id => $subforum)
	{
		if (isset($context['category_order'][$subforum['forumid']]) && count($context['category_order'][$subforum['forumid']]) > 1)
		{
			echo '
						<dt id="cat_txt' . $subforum['forumid'] . '">
							<strong>', $txt['order'], ':</strong>
						</dt>
						<dd id="cat_ord' . $subforum['forumid'] . '">
							<select name="cat_order' . $subforum['forumid'] . '" id="cat_order' . $subforum['forumid'] . '"' . ($subforum['forumid'] <> $_REQUEST['sub'] ? ' style="display: none;"' : '') . '>';

			// Print every existing category into a select box.
			foreach ($context['category_order'][$subforum['forumid']] as $order)
				echo '
									<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
			echo '
							</select>';
		}
		echo '
						</dd>';
	}]]></search>
		<add><![CDATA[// If this isn't the only subforum, let the user choose which subforum it should be placed in:
	if (count($subforum_tree) > 1)
	{
		echo '
						<dt>
							<strong>' . $txt['forumid_title']. '</strong><br />
							<span class="smalltext">' . $txt['forumid_desc'] . '</span>
						</dt>
						<dd>
							<select name="forum_id" onchange="SubForumsCategories(this.options[this.selectedIndex].value); return false;">';
		// Print every existing category into a select box.
		foreach ($subforum_tree as $row)
			echo '
								<option', $context['category']['forumid'] == $row['forumid'] ? ' selected="selected"' : '', ' value="', $row['forumid'], '">', $row['boardname'], '</option>';
		echo '
							</select>
						</dd>';
	} else {
		echo '
						<input type="hidden" name="forum_id" value="', $forumid, '" size="4" tabindex="', $context['tabindex']++, '" />';
	}

	// If this isn't the only category, let the user choose where this category should be positioned down the board index.
	foreach ($subforum_tree as $id => $subforum)
	{
		echo '
						<dt id="cat_txt' . $id . '"' . ($id <> $_REQUEST['sub'] ? ' style="display: none;"' : '') . '>
							<strong>', $txt['order'], ':</strong>
						</dt>
						<dd id="cat_ord' . $id . '"' . ($id <> $_REQUEST['sub'] ? ' style="display: none;"' : '') . '>
							<select name="cat_order' . $id . '"">';

		// Print every existing category into a select box.
		foreach ($context['category_order'][$id] as $order)
			echo '
									<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
		echo '
							</select>
						</dd>';
	}]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[	// Allow the user to edit the category name and/or choose whether you can collapse the category.]]></search>
		<add><![CDATA[
	// Allow the user to edit the category name and/or choose whether you can collapse the category.]]></add>
	</operation>
	
<!---------------------------------------------------------------------------->
<!-- Modification of Modify Board UI (ManageBoards.template.php) 			-->
<!---------------------------------------------------------------------------->
	<operation>
		<search position="replace"><![CDATA[foreach ($context['board_order'] as $cat => $boards)
		foreach ($boards as $board)
			echo ']]></search>
		<add><![CDATA[foreach ($context['board_order'] as $cat => $boards)
		echo ']]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2', (!empty($_REQUEST['sub']) ? ';sub=' . $_REQUEST['sub'] : ''), (!empty($_REQUEST['cat']) ? ';cat=' . $_REQUEST['cat'] : ''), '" method="post" accept-charset="', $context['character_set'], '">]]></search>
		<add><![CDATA[<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2', (!empty($_REQUEST['sub']) ? ';sub=' . $_REQUEST['sub'] : ''), '" method="post" accept-charset="', $context['character_set'], '">]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<select id="order" name="placement', $cat, '">]]></search>
		<add><![CDATA[<select id="order', $cat, '" name="placement', $cat, '" onchange="this.form.board_order', $cat, '.disabled = this.options[this.selectedIndex].value == \'\';">]]></add>
	</operation>
	<operation>
		<search position="replace"><![CDATA[<select name="new_cat', $subforum['forumid'], '" id="new_cat', $subforum['forumid'], '" onchange="hideBoards(this.options[this.selectedIndex].value);"', ($subforum['forumid'] <> $_REQUEST['sub'] ? ' style="display: none;"' : ''), '>';]]></search>
		<add><![CDATA[<select name="new_cat', $subforum['forumid'], '" id="new_cat', $subforum['forumid'], '" onchange="hideBoards(this.options[this.selectedIndex].value);"', ($subforum['forumid'] <> $_REQUEST['sub'] ? ' style="display: none;"' : ''), ((isset($context['board']['is_new']) && count($context['categories'][$subforum['forumid']]) > 0) || count($context['categories'][$subforum['forumid']]) > 1 ? '' : ' disabled="disabled"'), '>';]]></add>
	</operation>
</file>
</modification>