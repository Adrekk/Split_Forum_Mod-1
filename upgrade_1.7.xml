<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<id>Dougiefresh:Split_Forum</id>
<version>1.7</version>

<!-------------------------------------------------------------------------->
<!-- Modifications for better Simple Portal support (Load.php)            -->
<!-------------------------------------------------------------------------->
<file name="$sourcedir/Load.php">
	<operation>
		<search position="after"><![CDATA[// UTF-8 in regular expressions is unsupported on PHP(win) versions < 4.2.3.]]></search>
		<add><![CDATA[// Replace the Simple Portal settings with the Subforum setting if available:
	if (isset($subforum_tree[$forumid]['sp_portal']))
		$modSettings['sp_portal_mode'] = $subforum_tree[$forumid]['sp_portal'];
	if (isset($subforum_tree[$forumid]['sp_standalone']))
		$modSettings['sp_standalone_url'] = $subforum_tree[$forumid]['sp_standalone'];
		
	]]></add>
	</operation>
</file>
<file name="$sourcedir/PortalAdminMain.php" error="skip">
	<operation>
		<search position="before"><![CDATA[global $smcFunc, $context, $scripturl, $txt]]></search>
		<add><![CDATA[, $subforum_tree, $forumid]]></add>
	</operation>
	<operation>
		<search position="after"><![CDATA[saveDBSettings($config_vars);
		redirectexit('action=admin;area=portalconfig;sa=generalsettings');]]></search>
		<add><![CDATA[// Update the subforum array with the new settings:
		$subforum_tree[$forumid]['sp_portal'] = (int) $_POST['sp_portal_mode'];
		$subforum_tree[$forumid]['sp_standalone'] = $_POST['sp_standalone_url'];

		// Place the revised subforum array into the Settings.php file:
		require_once($sourcedir.'/Subs-Admin.php');
		updateSettingsFile(array('subforum_tree' => str_replace("\n", "", var_export($subforum_tree, true))));

		]]></add>
	</operation>
</file>
</modification>